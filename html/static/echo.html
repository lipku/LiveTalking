<!-- index.html -->
<html>
<head>
  <script type="text/javascript" src="mpegts-1.7.3.min.js"></script>
  <script type="text/javascript" src="http://cdn.sockjs.org/sockjs-0.3.4.js"></script>
  <script src="http://code.jquery.com/jquery-2.1.1.min.js"></script>
  <script src="recorder-core.js" charset="UTF-8"></script>
  <script src="wav.js" charset="UTF-8"></script>
  <script src="pcm.js" charset="UTF-8"></script>

  
</head>
<body>
  <div class="container">
    <h1>metahuman voice test</h1>
    <form class="form-inline" id="echo-form">
      <div class="form-group">
        <p>input text</p>

		<textarea cols="2" rows="3" style="width:600px;height:50px;" class="form-control" id="message"></textarea>
      </div>
      <button type="submit" class="btn btn-default">Send</button>
    </form>
    <div id="log">
		
	</div>
	<video id="video_player" width="40%" controls autoplay muted></video>
  </div>

  <div>------------------------------------------------------------------------------------------------------------------------------</div>
  <div class="div_class_topArea">

	<div class="div_class_recordControl">
		asr服务器地址(必填):
		<br>
		<input id="wssip" type="text" onchange="addresschange()" style="width: 500px;" value="wss://127.0.0.1:10095/"/>
		<br>
		<a id="wsslink" style="display: none;"  href="#" onclick="window.open('https://127.0.0.1:10095/', '_blank')"><div id="info_wslink">点此处手工授权wss://127.0.0.1:10095/</div></a>
		<br>
	<br>  
	<div  style="border:2px solid #ccc;display: none;">
		选择录音模式:<br/>

<label ><input name="recoder_mode" onclick="on_recoder_mode_change()" type="radio" value="mic" checked="true"/>麦克风 </label>&nbsp;&nbsp;
<label><input name="recoder_mode" onclick="on_recoder_mode_change()" type="radio" value="file" />文件 </label> 

		</div>
		
		
		 <div id="mic_mode_div" style="border:2px solid #ccc;display:none;">
		选择asr模型模式:<br/>

<label><input name="asr_mode" type="radio" value="2pass" />2pass </label>&nbsp;&nbsp;
<label><input name="asr_mode" type="radio" value="online" checked="true"/>online </label>&nbsp;&nbsp;
<label><input name="asr_mode" type="radio" value="offline" />offline </label>

		</div>
		
		<div id="rec_mode_div" style="border:2px solid #ccc;display:none;">
 

		  <input type="file" id="upfile">

		</div>
		
		<div  style="border:2px solid #ccc;display: none;">
			热词设置(一行一个关键字，空格隔开权重,如"阿里巴巴 20")：
			
			<textarea rows="1"  id="varHot"  style=" width: 100%;height:auto" >阿里巴巴 20&#13;hello world 40</textarea>
			
			</div>
		<div style="display: none;">语音识别结果显示：</div>
		<br>
		
		<textarea rows="10"  id="varArea" readonly="true" style=" width: 100%;height:auto;display: none;" ></textarea>
		<br>
		<div id="info_div">请点击开始</div>
		<div class="div_class_buttons">
			<button id="btnConnect">连接</button>
			<button id="btnStart">开始</button>
			<button id="btnStop">停止</button>

		</div>
		
		<audio id="audio_record" type="audio/wav" controls style="margin-top: 2px; width: 100%;display: none;"></audio>
	</div>
</div>

 <script src="wsconnecter.js" charset="utf-8"></script>
<script src="main.js" charset="utf-8"></script>

</body>
<script type="text/javascript" charset="utf-8">

	$(document).ready(function() {
	  var host = window.location.hostname
	  var ws = new WebSocket("ws://"+host+":8000/humanecho");
	  //document.getElementsByTagName("video")[0].setAttribute("src", aa["video"]);
	  ws.onopen = function() {
		console.log('Connected');
	  };
	  ws.onmessage = function(e) {
		console.log('Received: ' + e.data);
		data = e
		var vid = JSON.parse(data.data); 
		console.log(typeof(vid),vid)
		//document.getElementsByTagName("video")[0].setAttribute("src", vid["video"]);
		
	  };
	  ws.onclose = function(e) {
		console.log('Closed');
	  };

	  flvPlayer = mpegts.createPlayer({type: 'flv', url: "http://"+host+":8080/live/livestream.flv", isLive: true, enableStashBuffer: false});
	  flvPlayer.attachMediaElement(document.getElementById('video_player'));
	  flvPlayer.load();
	  flvPlayer.play();

	  $('#echo-form').on('submit', function(e) {
		e.preventDefault();
		var message = $('#message').val();
		console.log('Sending: ' + message);
		ws.send(message);
		$('#message').val('');
	  });
	});
</script>
 </html>