---
description: 数字人形象管理和制作指南
---

# 数字人形象管理指南

## Avatar 目录结构

数字人形象数据存放在 `data/avatars/` 目录下。

### 典型 Avatar 结构

```
data/avatars/
└── avatar_name/
    ├── image/          # 图像序列
    ├── audio.wav       # 音频文件
    ├── config.json     # 配置文件
    └── features/       # 预提取的特征（可选）
```

## 制作新 Avatar

### Wav2Lip Avatar

使用 `wav2lip/genavatar.py` 生成 Wav2Lip 模型的 avatar。

**要求**：
- 输入视频：清晰的人脸视频
- 视频长度：建议 3-5 分钟
- 分辨率：256x256 或 512x512
- 人脸位置：居中，占画面主要部分

### MuseTalk Avatar

使用 [genavatar_musetalk.py](mdc:genavatar_musetalk.py) 生成 MuseTalk 模型的 avatar。

**要求**：
- 输入视频：正面人脸视频
- 表情：自然、多样化
- 光照：均匀、稳定
- 背景：简洁、无干扰

### Ultralight Avatar

使用 `ultralight/genavatar.py` 生成 Ultralight 模型的 avatar。

## Avatar 配置

在 [data/custom_config.json](mdc:data/custom_config.json) 中配置自定义 avatar：

```json
[
  {
    "audiotype": 2,
    "imgpath": "data/customvideo/image",
    "audiopath": "data/customvideo/audio.wav"
  }
]
```

### 配置参数说明

- `audiotype`: 音频类型标识
- `imgpath`: 图像序列路径
- `audiopath`: 音频文件路径

## Avatar 优化

### 图像质量

1. **预处理**
   - 人脸检测和对齐
   - 裁剪和缩放
   - 色彩校正

2. **增强**
   - 超分辨率
   - 降噪
   - 光照归一化

### 音频质量

1. **音频处理**
   - 降噪
   - 音量归一化
   - 采样率转换

2. **语音特征**
   - 提取 mel 频谱
   - 音素对齐
   - 特征缓存

## 全身视频拼接

项目支持全身视频拼接功能。

### 制作步骤

1. **准备素材**
   - 上半身视频（用于口型驱动）
   - 全身视频（作为背景）

2. **配置参数**
   - 设置拼接区域
   - 调整融合参数
   - 测试效果

3. **优化融合**
   - 边缘羽化
   - 色彩匹配
   - 运动平滑

## 动作编排

支持在数字人不说话时播放自定义视频。

### 配置方法

1. **准备动作视频**
   - 空闲状态动作
   - 过渡动画
   - 循环播放片段

2. **设置触发条件**
   - 静默时长阈值
   - 随机播放概率
   - 动作优先级

## Avatar 切换

支持运行时切换数字人形象。

### 实现方式

1. **预加载**
   - 提前加载多个 avatar
   - 缓存常用 avatar

2. **快速切换**
   - 无缝过渡
   - 最小化延迟
   - 保持音视频同步

## 最佳实践

1. **视频素材**
   - 使用高质量摄像设备
   - 保持稳定的光照和背景
   - 录制多样化的表情和动作

2. **性能考虑**
   - 控制 avatar 文件大小
   - 预提取特征以加速加载
   - 使用合适的分辨率

3. **用户体验**
   - 提供多种 avatar 选择
   - 支持自定义上传
   - 快速预览效果

## 模型特定注意事项

### Wav2Lip
- 对口型同步要求高
- 适合正面人脸
- 支持较高分辨率

### MuseTalk
- 表情更自然
- 需要更多显存
- 适合长时间对话

### Ultralight
- 轻量级模型
- 推理速度快
- 适合资源受限环境
