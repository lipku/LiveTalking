---
description: 数字人模型集成和扩展指南
---

# 数字人模型集成指南

## 模型架构

所有数字人模型都继承自 [basereal.py](mdc:basereal.py) 中的 `BaseReal` 类。

## 添加新模型的步骤

1. **创建模型类**
   - 继承 `BaseReal` 类
   - 实现必要的抽象方法
   - 参考现有实现：[lipreal.py](mdc:lipreal.py), [musereal.py](mdc:musereal.py)

2. **实现核心方法**
   - `__init__()` - 初始化模型和参数
   - `render()` - 渲染帧的核心逻辑
   - `process_frames()` - 处理音频和生成视频帧

3. **在 app.py 中注册**
   - 在 [app.py](mdc:app.py) 的 `build_nerfreal()` 函数中添加新模型的条件分支
   - 添加命令行参数支持

## 模型文件组织

- 模型权重文件放在 `models/` 目录
- 数字人形象数据放在 `data/avatars/` 目录
- 每个 avatar 包含：
  - 图像序列或视频文件
  - 音频特征文件
  - 配置文件

## 性能优化建议

1. **GPU 内存管理**
   - 使用 torch.no_grad() 进行推理
   - 及时释放不需要的张量
   - 考虑使用半精度 (fp16) 推理

2. **批处理**
   - 尽可能批量处理帧
   - 平衡延迟和吞吐量

3. **预热**
   - 在服务启动时进行模型预热
   - 避免第一次推理的卡顿

4. **并发处理**
   - 每个会话使用独立的模型实例
   - 注意显存限制和并发数
