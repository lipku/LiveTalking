---
description: 大语言模型集成指南
---

# LLM 集成指南

## 核心文件

[llm.py](mdc:llm.py) - 大语言模型集成模块

## LLM 功能

数字人可以集成大语言模型实现智能对话功能。

### 支持的 LLM

- OpenAI GPT 系列
- 其他兼容 OpenAI API 的模型
- 本地部署的 LLM

## 集成步骤

1. **配置 API**
   - 设置 API 密钥
   - 配置 API 端点
   - 选择模型版本

2. **实现对话逻辑**
   - 接收用户输入（文本或语音转文本）
   - 调用 LLM API 获取回复
   - 将回复文本转换为语音

3. **上下文管理**
   - 维护对话历史
   - 控制上下文长度
   - 实现多轮对话

## 使用示例

```python
from llm import llm_response

# 获取 LLM 回复
response = llm_response(user_input, context)

# 将回复发送给 TTS
audio = tts.synthesize(response)
```

## 优化建议

1. **响应速度**
   - 使用流式输出（如果支持）
   - 设置合理的超时时间
   - 考虑使用缓存

2. **成本控制**
   - 限制请求频率
   - 控制 token 使用量
   - 使用更经济的模型

3. **内容安全**
   - 过滤敏感内容
   - 实现内容审核
   - 设置回复长度限制

4. **用户体验**
   - 提供"思考中"的提示
   - 支持打断当前回复
   - 处理 API 错误情况

## 对话流程

1. **用户输入** → ASR 语音识别
2. **文本输入** → LLM 处理
3. **LLM 回复** → TTS 语音合成
4. **音频输出** → 数字人口型同步
5. **视频输出** → WebRTC 推流

## 高级功能

- **情感分析**：根据对话内容调整数字人表情
- **意图识别**：识别用户意图并执行相应操作
- **知识库集成**：结合 RAG 技术提供专业回答
- **多语言支持**：支持多种语言的对话
