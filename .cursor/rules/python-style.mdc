---
globs: *.py
---

# Python 代码风格规范

## 通用规则

1. **编码规范**
   - 使用 UTF-8 编码
   - 遵循 PEP 8 代码风格
   - 使用 4 个空格缩进，不使用 Tab

2. **导入顺序**
   - 标准库导入
   - 第三方库导入
   - 本地应用/库导入
   - 各组之间用空行分隔

3. **类型提示**
   - 为函数参数和返回值添加类型提示
   - 使用 `typing` 模块的类型（Dict, List, Optional 等）

4. **文档字符串**
   - 为所有公共模块、函数、类和方法编写文档字符串
   - 使用中文或英文，保持一致

## 项目特定规范

1. **日志记录**
   - 使用 [logger.py](mdc:logger.py) 中的 logger 实例
   - 不要使用 print()，使用 logger.info(), logger.error() 等

2. **异步编程**
   - WebRTC 相关代码使用 asyncio
   - 使用 async/await 语法
   - 注意线程安全和协程安全

3. **资源管理**
   - 使用 with 语句管理文件和资源
   - 及时释放 GPU 内存，使用 torch.cuda.empty_cache()
   - 使用 gc.collect() 进行垃圾回收

4. **错误处理**
   - 使用 try-except 捕获异常
   - 记录详细的错误信息到日志
   - 不要吞掉异常，至少要记录

5. **多进程/多线程**
   - 使用 torch.multiprocessing 而不是标准 multiprocessing
   - 注意进程间通信和数据共享
